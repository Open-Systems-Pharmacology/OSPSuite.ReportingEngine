<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ospsuite.reportingengine">
<title>Qualification Workflow • ospsuite.reportingengine</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Qualification Workflow">
<meta property="og:description" content="ospsuite.reportingengine">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ospsuite.reportingengine</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/ospsuite-reportingengine.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/add-title-page.html">Add a title page to your workflow report</a>
    <a class="dropdown-item" href="../articles/demography.html">Demography Parameters in Population Workflows</a>
    <a class="dropdown-item" href="../articles/excel-template.html">Excel Template</a>
    <a class="dropdown-item" href="../articles/goodness-of-fit.html">Time profiles and Residuals task</a>
    <a class="dropdown-item" href="../articles/mass-balance.html">Mass Balance</a>
    <a class="dropdown-item" href="../articles/pk-parameters.html">PK parameters</a>
    <a class="dropdown-item" href="../articles/plot-settings.html">Plot settings</a>
    <a class="dropdown-item" href="../articles/pop-pk-parameters.html">PK Parameters in Population Workflows</a>
    <a class="dropdown-item" href="../articles/qualification-workflow.html">Qualification Workflow</a>
    <a class="dropdown-item" href="../articles/sensitivity-analysis.html">Sensitivity Analysis</a>
    <a class="dropdown-item" href="../articles/word-report.html">How to work with word reports</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/open-systems-pharmacology/ospsuite.reportingengine/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Qualification Workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/open-systems-pharmacology/ospsuite.reportingengine/blob/HEAD/vignettes/qualification-workflow.Rmd" class="external-link"><code>vignettes/qualification-workflow.Rmd</code></a></small>
      <div class="d-none name"><code>qualification-workflow.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/open-systems-pharmacology/ospsuite.reportingengine" class="external-link">ospsuite.reportingengine</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: ospsuite.reportingengine</span></span>
<span><span class="co">#&gt; Loading required package: ospsuite</span></span>
<span><span class="co">#&gt; Loading required package: rClr</span></span>
<span><span class="co">#&gt; Loading the dynamic library for Microsoft .NET runtime...</span></span>
<span><span class="co">#&gt; Loaded Common Language Runtime version 4.0.30319.42000</span></span>
<span><span class="co">#&gt; Loading required package: tlf</span></span></code></pre></div>
<div class="section level2">
<h2 id="objectives">Objectives<a class="anchor" aria-label="anchor" href="#objectives"></a>
</h2>
<p>The <a href="https://docs.open-systems-pharmacology.org/shared-tools-and-example-workflows/qualification" class="external-link">qualification
framework</a> enables an automated validation of various scenarios
(use-cases) supported by the OSP platform. This technical framework is
used, for example, to release, in full confidence, a new version of the
OSP Suite by verifying automatically that an ever-growing list of
scenarios is performing as expected. Qualification workflows as
performed by the package <code>ospsuite.reportingengine</code> aims at
building Qualification Reports in Markdown and Word format. This article
aims at introducing how to work with
<code>ospsuite.reportingengine</code> to perform such qualification
workflows.</p>
</div>
<div class="section level2">
<h2 id="qualification-runner">Qualification runner<a class="anchor" aria-label="anchor" href="#qualification-runner"></a>
</h2>
<p>The <strong>QualificationRunner</strong> is the software in charge of
initializing and managing the qualification workflow by creating and
organizing the inputs required for the reporting engine.</p>
<p>The function <code>startQualificationRunner</code>, inspired from its
Matlab version, launches the <strong>QualificationRunner</strong> on a
project. The function requires the inputs below:</p>
<ul>
<li>
<code>qualificationRunnerFolder</code>: the directory where the file
<strong>QualificationRunner.exe</strong> is located</li>
<li>
<code>qualificationPlanFile</code>: the path of the input
qualification plan (json file summarizing the project
qualification)</li>
<li>
<code>outputFolder</code>: the path of the output directory created
by the qualification runner</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/startQualificationRunner.html">startQualificationRunner</a></span><span class="op">(</span><span class="va">qualificationRunnerFolder</span>, <span class="va">qualificationPlanFile</span>, <span class="va">outputFolder</span><span class="op">)</span></span></code></pre></div>
<p>Note that, in the R version of <code>startQualificationRunner</code>,
the simulations and PK analyses are not run from the
<strong>QualificationRunner</strong> but from the workflow itself. This
update aims at preventing the runs of all the simulations available in
the qualification. Only the simulations results and PK analyses required
by the configuration plan are performed to optimize the building time of
a qualification report.</p>
</div>
<div class="section level2">
<h2 id="configuration-plan">Configuration Plan<a class="anchor" aria-label="anchor" href="#configuration-plan"></a>
</h2>
<p>The configuration plan is included in a json file, created by the
qualification runner, that defines the configuration of the final
report. The function <code>loadConfigurationPlan</code> reads such a
file and creates a <code>ConfigurationPlan</code> object that all the
knowledge required to build the final report. It is internally called
upon creation of a <code>QualificationWorkflow</code> and requires the
inputs below:</p>
<ul>
<li>
<code>configurationPlanFile</code>: path of the Configuration Plan
json file used by the Qualification workflow</li>
<li>
<code>workflowFolder</code>: path of the output directory created
and/or used by the Workflow.</li>
</ul>
</div>
<div class="section level2">
<h2 id="qualification-workflow">Qualification workflow<a class="anchor" aria-label="anchor" href="#qualification-workflow"></a>
</h2>
<p>Qualification workflows are built from
<code>Qualificationworkflow</code> objects which derive from
<code>Workflow</code> objects. As such, they are also based on the
concept of tasks but show a difference in the way they are created.</p>
<div class="section level3">
<h3 id="how-to-create-a-qualification-workflow">How to create a qualification workflow<a class="anchor" aria-label="anchor" href="#how-to-create-a-qualification-workflow"></a>
</h3>
<p>The function <code>loadQualificationWorkflow</code> is advised to
create a <code>QualificationWorkflow</code> object from a configuration
plan. It requires the same inputs as <code>loadConfigurationPlan</code>
(<code>workflowFolder</code> and
<code>configurationPlanFile</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">workflow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadQualificationWorkflow.html">loadQualificationWorkflow</a></span><span class="op">(</span><span class="va">workflowFolder</span>, <span class="va">configurationPlanFile</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="qualification-workflow-features">Qualification workflow features<a class="anchor" aria-label="anchor" href="#qualification-workflow-features"></a>
</h3>
<div class="section level4">
<h4 id="configuration-plan-1">Configuration Plan<a class="anchor" aria-label="anchor" href="#configuration-plan-1"></a>
</h4>
<p>All <code>QualificationWorkflow</code> objects include a
<code>configurationPlan</code> field. This field is a
<code>ConfigurationPlan</code> object that provides a smart interface
for building the report.</p>
<p>In particular, all the fields below are reorganized in a data.frame
format clarifying the design of the configuration plan.</p>
<ul>
<li><code>simulationMappings</code></li>
<li><code>observedDataSets</code></li>
<li><code>sections</code></li>
</ul>
<p>Additionally, the <code>configurationPlan</code> field includes many
<code>get</code> methods to search for specific paths of files managed
by the configuration plan
(<code>$getSimulationPath(project, simulation)</code>,
<code>$getObservedDataPath(id)</code>, etc)</p>
</div>
<div class="section level4">
<h4 id="tasks-available-for-qualification-workflow">Tasks available for Qualification workflow<a class="anchor" aria-label="anchor" href="#tasks-available-for-qualification-workflow"></a>
</h4>
<p>Two simulation tasks are available and active by default in the
qualification workflows:</p>
<ul>
<li>
<code>simulate</code>: simulate time profile results requested in
the report plots</li>
<li>
<code>calculatePKParameters</code>: calculate the PK Parameters
requested in the PK and DDI ratio plots</li>
</ul>
<p>Their results are stored within the <code>workflowFolder</code>
output directory, in <em>SimulationResults</em> and
<em>PKAnalysisResults</em> directories respectively.</p>
<p>Five plot tasks are available in the qualification workflows, they
are only active if defined by the configuration plan:</p>
<ul>
<li>
<code>plotTimeProfiles</code>: plot time profiles of the simulated
outputs and/or observed data.</li>
<li>
<code>plotGOFMerged</code>: plot goodness of fit results of grouped
simulated outputs vs observed data.</li>
<li>
<code>plotComparisonTimeProfile</code>: plot comparison of time
profiles from the simulated outputs and/or observed data.</li>
<li>
<code>plotPKRatio</code>: plot PK ratios of simulated vs observed PK
parameters as a function of covariate (usually Age).</li>
<li>
<code>plotDDIRatio</code>: plot Drug-Drug Interaction ratios of
simulated vs observed PK parameters.</li>
</ul>
</div>
<div class="section level4">
<h4 id="settings-and-artifacts">Settings and artifacts<a class="anchor" aria-label="anchor" href="#settings-and-artifacts"></a>
</h4>
<p>Most of the settings and artifacts are read from the configuration
plan file and translated into task settings. Settings for simulations
include <code>showProgress</code> to show the progress of the
<code>simulate</code> task and <code>allowedCores</code> to perform the
simulations in parallel.</p>
<p>Plot tasks can include multiple results for the report, usually
called artifacts. If the field <strong>Artifacts</strong> is not
mentioned in a plot of the configuration plan, all its corresponding
artifacts results will be added to the report.</p>
<div class="section level5">
<h5 id="predictedvsobserved-and-residualsovertime">predictedVsObserved and residualsOverTime<a class="anchor" aria-label="anchor" href="#predictedvsobserved-and-residualsovertime"></a>
</h5>
<p>For <code>plotGOFMerged</code> and <code>plotDDIRatio</code> tasks,
the plots represent observed vs predicted data. It is consequently
possible to include them as predicted vs observed and/or residuals vs
time/predicted by including the options
<strong>predictedVsObserved</strong>,
<strong>residualsOverPredicted</strong> and
<strong>residualsOverTime</strong> in the field
<strong>PlotTypes</strong> of the configuration plan.</p>
</div>
<div class="section level5">
<h5 id="geometric-mean-fold-error-gmfe">Geometric Mean Fold Error (GMFE)<a class="anchor" aria-label="anchor" href="#geometric-mean-fold-error-gmfe"></a>
</h5>
<p>For <code>plotGOFMerged</code>, <code>plotPKRatio</code> and
<code>plotDDIRatio</code> tasks, it is possible to include a
<strong>GMFE</strong> artifact in the configuration plan. This artifact
corresponds to the addition of a table showing the Geometric Mean Fold
Error (<em>GMFE</em>) of the <em>residuals</em> calculated for specific
plot using the formula <span class="math inline">\(GMFE = 10^{\Sigma
log_{10}(residuals)}\)</span>.</p>
</div>
<div class="section level5">
<h5 id="measure">Measure<a class="anchor" aria-label="anchor" href="#measure"></a>
</h5>
<p>For <code>plotPKRatio</code> and <code>plotDDIRatio</code> tasks, it
is possible to include a <strong>Measure</strong> artifact in the
configuration plan. This artifact corresponds to the addition of a table
showing:</p>
<ul>
<li>For <code>plotPKRatio</code>, count and percent of ratios lying
within 1.5- and 2-fold error ranges.</li>
<li>For <code>plotDDIRatio</code>, count and percent of ratios lying
within 2-fold and Guest <em>et al.</em> error ranges.</li>
</ul>
</div>
<div class="section level5">
<h5 id="table">Table<a class="anchor" aria-label="anchor" href="#table"></a>
</h5>
<p>For <code>plotPKRatio</code> task, it is possible to include a
<strong>Table</strong> artifact in the configuration plan. This artifact
corresponds to the addition of a table showing comprehensive observed
and simulated PK data of the PK Ratio analysis.</p>
</div>
<div class="section level5">
<h5 id="settings">Settings<a class="anchor" aria-label="anchor" href="#settings"></a>
</h5>
<p>Since plot tasks can include numerical results, <code>digits</code>
and <code>scientific</code> are fields available in each task
<code>settings</code> that will define the format of their numeric
values.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="how-to-update-and-re-run-a-qualification-workflow">How to update and re-run a qualification workflow<a class="anchor" aria-label="anchor" href="#how-to-update-and-re-run-a-qualification-workflow"></a>
</h3>
<p>If simulations need to be re-run, it is advised to reload the
workflow using <code>loadQualificationWorkflow</code>.</p>
<p>In case the update does not require to re-run simulations
(e.g. updating the section content, modifying plot aesthetics or
removing a plot), the <code>QualificationWorkflow</code> method
<code>$updateConfigurationPlan(configurationPlanFile)</code> can be used
to avoid the process of reloading and checking all the simulations of
the workflow.</p>
<p>Then, you can also <code>inactivate</code> the tasks corresponding to
the re-run of the simulations before re-running the workflow.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reload Configuration Plan</span></span>
<span><span class="va">workflow</span><span class="op">$</span><span class="fu">updateConfigurationPlan</span><span class="op">(</span></span>
<span>  configurationPlanFile <span class="op">=</span> <span class="va">newConfigurationPlanFile</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inactivate simulations already performed</span></span>
<span><span class="va">workflow</span><span class="op">$</span><span class="va">simulate</span><span class="op">$</span><span class="fu">inactivate</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">workflow</span><span class="op">$</span><span class="va">calculatePKParameters</span><span class="op">$</span><span class="fu">inactivate</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Re-run and build updated report</span></span>
<span><span class="va">workflow</span><span class="op">$</span><span class="fu">runWorkflow</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="template">Template<a class="anchor" aria-label="anchor" href="#template"></a>
</h3>
<p>A template R script for qualification workflows is available below.
You can also download it from <a href="https://github.com/Open-Systems-Pharmacology/OSPSuite.ReportingEngine/blob/develop/inst/extdata/qualification-workflow-template.R" class="external-link">GitHub</a>.
The template aims at creating a function wrapping the usage of the
qualification workflow including the call to the qualification runner
and named <code>createQualificationReport</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @title createQualificationReport</span></span>
<span><span class="co">#' @description Run a qualification workflow to create a qualification report.</span></span>
<span><span class="co">#' @param qualificationRunnerFolder Folder where QualificationRunner.exe is located</span></span>
<span><span class="co">#' @param pkSimPortableFolder Folder where PK-Sim is located.</span></span>
<span><span class="co">#' If not specified, installation path will be read from the registry (available only in case of full **non-portable** installation).</span></span>
<span><span class="co">#' This option is **MANDATORY** for the portable version of PK-Sim.</span></span>
<span><span class="co">#' @param createWordReport Logical defining if a `docx` version of the report should also be created.</span></span>
<span><span class="co">#' Note that `pandoc` installation is required for this feature</span></span>
<span><span class="co">#' [https://github.com/Open-Systems-Pharmacology/OSPSuite.ReportingEngine/wiki/Installing-pandoc]</span></span>
<span><span class="co">#' @param maxSimulationsPerCore An integer that set the maximimum number of simulations per core</span></span>
<span><span class="co">#' @param versionInfo A `QualificationVersionInfo` object to update title page with Qualification Version Information</span></span>
<span><span class="co">#' @param wordConversionTemplate File name of docx template document passed to Pandoc for the conversion of the md report into docx</span></span>
<span><span class="co">#' Default template is available using `system.file("extdata", "reference.docx", package = "ospsuite.reportingengine")`</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' # Create a Qualification Report without any option and running v9.1.1 of Qualification Runner</span></span>
<span><span class="co">#' createQualificationReport("C:/Software/QualificationRunner9.1.1")</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' # Create a Qualification Report and turn of the creation of a doc version</span></span>
<span><span class="co">#' createQualificationReport("C:/Software/QualificationRunner9.1.1", createWordReport = FALSE)</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' # Create a Qualification Report and set the number of simulations to be run per core</span></span>
<span><span class="co">#' createQualificationReport("C:/Software/QualificationRunner9.1.1", maxSimulationsPerCore = 8)</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' # Create a Qualification Report and update Qualification Version Information on title page</span></span>
<span><span class="co">#' versionInfo &lt;- QualificationVersionInfo$new("1.1", "2.2","3.3")</span></span>
<span><span class="co">#' createQualificationReport("C:/Software/QualificationRunner9.1.1", versionInfo = versionInfo)</span></span>
<span><span class="co">#' </span></span>
<span><span class="va">createQualificationReport</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">qualificationRunnerFolder</span>,</span>
<span>                                      <span class="va">pkSimPortableFolder</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                      <span class="va">createWordReport</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                      <span class="va">maxSimulationsPerCore</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                      <span class="va">versionInfo</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                      <span class="va">wordConversionTemplate</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/open-systems-pharmacology/ospsuite.reportingengine" class="external-link">ospsuite.reportingengine</a></span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#-------- STEP 1: Define workflow settings --------#</span></span>
<span>  <span class="co">#' replace `workingDirectory` and `qualificationPlanName` with your paths</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="co">#' The directories are assumed the following structure</span></span>
<span>  <span class="co">#' `workingDirectory`</span></span>
<span>  <span class="co">#'   - `input`</span></span>
<span>  <span class="co">#'     - `qualificationPlanName`</span></span>
<span>  <span class="co">#'   - `re_input`</span></span>
<span>  <span class="co">#'     - `configurationPlanFile`</span></span>
<span>  <span class="co">#'   - `re_output`</span></span>
<span>  <span class="co">#'     - `report`</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="co">#' In case your folder structure is different from assumed above,</span></span>
<span>  <span class="co">#' the paths below must be adjusted as well:</span></span>
<span>  <span class="co">#' - `qualificationPlanFile`: path of qualification plan file run by Qualification Runner</span></span>
<span>  <span class="co">#' - `reInputFolder`: input path for the Reporting engine</span></span>
<span>  <span class="co">#' - `reOutputFolder`: outputs of the Reporting Engine will be created here</span></span>
<span>  <span class="co">#' - `reportName`:  path of final report</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="co">#' **Template parameters to be replaced below**</span></span>
<span></span>
<span>  <span class="co">#' `workingDirectory`: current directory is used as default working directory</span></span>
<span>  <span class="va">workingDirectory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">qualificationPlanName</span> <span class="op">&lt;-</span> <span class="st">"qualification_plan.json"</span></span>
<span>  <span class="va">qualificationPlanFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">workingDirectory</span>, <span class="st">"input"</span>, <span class="va">qualificationPlanName</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#' The default outputs of qualification runner should be generated under `&lt;workingDirectory&gt;/re_input`</span></span>
<span>  <span class="va">reInputFolder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">workingDirectory</span>, <span class="st">"re_input"</span><span class="op">)</span></span>
<span>  <span class="co">#' The default outputs or RE should be generated under `&lt;workingDirectory&gt;/re_output`</span></span>
<span>  <span class="va">reOutputFolder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">workingDirectory</span>, <span class="st">"re_output"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#' Configuration Plan created from the Qualification Plan by the Qualification Runner</span></span>
<span>  <span class="va">configurationPlanName</span> <span class="op">&lt;-</span> <span class="st">"report-configuration-plan"</span></span>
<span>  <span class="va">configurationPlanFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">reInputFolder</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">configurationPlanName</span>, <span class="st">".json"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#' Option to record the time require to run the workflow.</span></span>
<span>  <span class="co">#' The timer will calculate calculation time form internal `Sys.time` function</span></span>
<span>  <span class="va">recordWorkflowTime</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span>  <span class="co">#' Set watermark that will appear in all generated plots</span></span>
<span>  <span class="co">#' Default is no watermark. `Label` objects from `tlf` package can be used to specifiy watermark font.</span></span>
<span>  <span class="va">watermark</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span></span>
<span>  <span class="co">#' If not set, report created will be named `report.md` and located in the worflow folder namely `reOutputFolder`</span></span>
<span>  <span class="va">reportFolder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">workingDirectory</span>, <span class="st">"report"</span><span class="op">)</span></span>
<span>  <span class="va">reportPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">reportFolder</span>, <span class="st">"report.md"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#----- Optional parameters for the Qualification Runner -----#</span></span>
<span>  <span class="co">#' If not null, `logFile` is passed internally via the `-l` option</span></span>
<span>  <span class="va">logFile</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="co">#' If not null, `logLevel` is passed internally via the `--logLevel` option</span></span>
<span>  <span class="va">logLevel</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="co">#' If `overwrite` is set to true, eventual results from the previous run of the QualiRunner/RE will be removed first</span></span>
<span>  <span class="va">overwrite</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span>  <span class="co">#-------- STEP 2: Qualification Runner  --------#</span></span>
<span>  <span class="co">#' Start timer to track time if option `recordWorkflowTime` is set to TRUE</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">recordWorkflowTime</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co">#' Start Qualification Runner to generate inputs for the reporting engine</span></span>
<span>  <span class="fu"><a href="../reference/startQualificationRunner.html">startQualificationRunner</a></span><span class="op">(</span></span>
<span>    qualificationRunnerFolder <span class="op">=</span> <span class="va">qualificationRunnerFolder</span>,</span>
<span>    qualificationPlanFile <span class="op">=</span> <span class="va">qualificationPlanFile</span>,</span>
<span>    outputFolder <span class="op">=</span> <span class="va">reInputFolder</span>,</span>
<span>    pkSimPortableFolder <span class="op">=</span> <span class="va">pkSimPortableFolder</span>,</span>
<span>    configurationPlanName <span class="op">=</span> <span class="va">configurationPlanName</span>,</span>
<span>    overwrite <span class="op">=</span> <span class="va">overwrite</span>,</span>
<span>    logFile <span class="op">=</span> <span class="va">logFile</span>,</span>
<span>    logLevel <span class="op">=</span> <span class="va">logLevel</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co">#' Print timer tracked time if option `recordWorkflowTime` is set to TRUE</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">recordWorkflowTime</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Qualification Runner Duration: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">toc</span> <span class="op">-</span> <span class="va">tic</span><span class="op">)</span> <span class="op">/</span> <span class="fl">60</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">" minutes"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co">#-------- STEP 3: Run Qualification Workflow  --------#</span></span>
<span>  <span class="co"># If version info is provided update title page</span></span>
<span>  <span class="va">titlePageFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">reInputFolder</span>, <span class="st">"Intro/titlepage.md"</span><span class="op">)</span> </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">versionInfo</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">titlePageFile</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/adjustTitlePage.html">adjustTitlePage</a></span><span class="op">(</span><span class="va">titlePageFile</span>, qualificationVersionInfo <span class="op">=</span> <span class="va">versionInfo</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">#' Load `QualificationWorkflow` object from configuration plan</span></span>
<span>  <span class="va">workflow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadQualificationWorkflow.html">loadQualificationWorkflow</a></span><span class="op">(</span></span>
<span>    workflowFolder <span class="op">=</span> <span class="va">reOutputFolder</span>,</span>
<span>    configurationPlanFile <span class="op">=</span> <span class="va">configurationPlanFile</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co">#' Set the name of the final report</span></span>
<span>  <span class="va">workflow</span><span class="op">$</span><span class="va">reportFilePath</span> <span class="op">&lt;-</span> <span class="va">reportPath</span></span>
<span>  <span class="va">workflow</span><span class="op">$</span><span class="va">createWordReport</span> <span class="op">&lt;-</span> <span class="va">createWordReport</span></span>
<span>  <span class="va">workflow</span><span class="op">$</span><span class="va">wordConversionTemplate</span> <span class="op">&lt;-</span> <span class="va">wordConversionTemplate</span></span>
<span></span>
<span>  <span class="co">#' Set watermark. If set, it will appear in all generated plots</span></span>
<span>  <span class="va">workflow</span><span class="op">$</span><span class="fu">setWatermark</span><span class="op">(</span><span class="va">watermark</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#' Set the maximimum number of simulations per core if defined</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">maxSimulationsPerCore</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">workflow</span><span class="op">$</span><span class="va">simulate</span><span class="op">$</span><span class="va">settings</span><span class="op">$</span><span class="va">maxSimulationsPerCore</span> <span class="op">&lt;-</span> <span class="va">maxSimulationsPerCore</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">#' Activate/Deactivate tasks of qualification workflow prior running</span></span>
<span>  <span class="co"># workflow$inactivateTasks("simulate")</span></span>
<span>  <span class="co"># workflow$inactivateTasks("calculatePKParameters")</span></span>
<span>  <span class="co"># workflow$inactivateTasks("plotTimeProfiles")</span></span>
<span>  <span class="co"># workflow$inactivateTasks("plotComparisonTimeProfile")</span></span>
<span>  <span class="co"># workflow$inactivateTasks("plotGOFMerged")</span></span>
<span>  <span class="co"># workflow$inactivateTasks("plotPKRatio")</span></span>
<span>  <span class="co"># workflow$inactivateTasks("plotDDIRatio")</span></span>
<span>  </span>
<span>  <span class="co">#' Run the `QualificatitonWorklfow`</span></span>
<span>  <span class="va">workflow</span><span class="op">$</span><span class="fu">runWorkflow</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#' Print timer tracked time if option `recordWorkflowTime` is set to TRUE</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">recordWorkflowTime</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Qualification Workflow Total Duration: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">toc</span> <span class="op">-</span> <span class="va">tic</span><span class="op">)</span> <span class="op">/</span> <span class="fl">60</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">" minutes"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="creation-of-a-word-report">Creation of a word report<a class="anchor" aria-label="anchor" href="#creation-of-a-word-report"></a>
</h2>
<p>By default, the qualification workflow field
<code>createWordReport</code> is set to TRUE. This option requests <a href="https://pandoc.org/" class="external-link"><strong>Pandoc</strong></a> to convert the
report to a word version (with extension <em>docx</em>).</p>
<p>Note that <a href="https://github.com/Open-Systems-Pharmacology/OSPSuite.ReportingEngine/wiki/Installing-pandoc" class="external-link"><strong>Pandoc</strong>
installation</a> is required for using this feature.</p>
<p>The conversion to word uses a reference word document that defines
each style of report (e.g. <em>Title</em>, <em>Heading 1</em>,
<em>Normal</em>, etc.). Users can input their own reference word
document using the option <code>wordConversionTemplate</code> as
previously illustrated in the template. The default reference word
document can be found on <a href="https://github.com/Open-Systems-Pharmacology/OSPSuite.ReportingEngine/blob/develop/inst/extdata/reference.docx" class="external-link">GitHub</a>.</p>
</div>
<div class="section level2">
<h2 id="referencing">Referencing<a class="anchor" aria-label="anchor" href="#referencing"></a>
</h2>
<p>To create references in the final report, html tags are used by the
qualification workflow as illustrated below. Note that spaces should not
be used as reference ids.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="kw">&lt;a</span> <span class="er">id</span><span class="ot">=</span><span class="st">"my-reference-id"</span><span class="kw">&gt;&lt;/a&gt;</span></span></code></pre></div>
<p>The markdown link to the reference above can then be written as:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co">[</span><span class="ot">display text</span><span class="co">](#my-reference-id)</span></span></code></pre></div>
<div class="section level3">
<h3 id="dynamic-references">Dynamic references<a class="anchor" aria-label="anchor" href="#dynamic-references"></a>
</h3>
<p>References for sections, figures and tables created by the
qualification workflow are generated dynamically.</p>
<p>For section references, the field <strong>Reference</strong> is used
in priority by the configuration plan to generate the reference id. In
case, such reference is not defined, the qualification workflow uses the
<strong>Id</strong> of the section. If no <strong>Reference</strong> nor
<strong>Id</strong> is defined, the qualification workflow generate a
reference id named
<code>"undefined-section-&lt;section index&gt;"</code>.</p>
<p>Tables and figures are numbered internally within first level
sections (section whose title start with one markdown character
<code>"#"</code> and are also referenced).</p>
<p>The algorithm for numbering the figures and tables will look for the
keywords <strong><code>Figure:</code></strong> and
<strong><code>Table:</code></strong> as first element of a line
(italic/bold characters are ignored by the algorithm if there is no
space between the keyword and the <code>"*"</code> or <code>"_"</code>
characters).</p>
<p>Their references follow the nomenclature below:</p>
<ul>
<li>For Figures:
<code>&lt;a id="figure-&lt;section number&gt;-&lt;internal figure count&gt;"&gt;&lt;/a&gt;</code>
</li>
<li>For Table:
<code>&lt;a id="table-&lt;section number&gt;-&lt;internal table count&gt;"&gt;&lt;/a&gt;</code>
</li>
</ul>
<p>For instance, the second table encountered within section 3
(e.g. section in 3.1.4) would be referenced:
<code>&lt;a id="table-3-2"&gt;&lt;/a&gt;</code></p>
</div>
<div class="section level3">
<h3 id="user-defined-references">User-defined references<a class="anchor" aria-label="anchor" href="#user-defined-references"></a>
</h3>
<p>Users can define their own static references to include in the
report. For instance, user can cite articles in the report using
exponent notations as illustrated in the example below:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>text related to article <span class="co">[</span><span class="ot">&lt;sup&gt;1&lt;/sup&gt;</span><span class="co">](#citations)</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>some text in between</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="kw">&lt;a</span> <span class="er">id</span><span class="ot">=</span><span class="st">"citations"</span><span class="kw">&gt;&lt;/a&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="fu">### Citations</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="kw">&lt;sup&gt;</span>1<span class="kw">&lt;/sup&gt;</span> Cited article</span></code></pre></div>
<p>which would render as below in the report:</p>
<p>text related to article <a href="#citations"><sup>1</sup></a></p>
<p><br> some text in between <br></p>
<p><a id="citations"></a></p>
<div class="section level4">
<h4 id="citations">Citations<a class="anchor" aria-label="anchor" href="#citations"></a>
</h4>
<p><sup>1</sup> Cited article</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Sevestre, Juri Solodenko, Pierre Chelle, Abdullah Hamadeh.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
